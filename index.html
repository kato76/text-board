/**
 * =========================
 * タブレット → PC
 * お母さまの発話を B列に追記
 * =========================
 */
function doPost(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheets()[0];
  const data = JSON.parse(e.postData.contents);
  const text = data.text || "";

  const lastRow = sheet.getLastRow();
  const nextRow = lastRow + 1;

  // 日本時間：日付＋時刻
  const now = Utilities.formatDate(
    new Date(),
    "Asia/Tokyo",
    "yyyy/MM/dd HH:mm:ss"
  );

  sheet.getRange(nextRow, 2).setValue(text); // B列：お母さま
  sheet.getRange(nextRow, 3).setValue(now);  // C列：日時

  return ContentService
    .createTextOutput("OK")
    .setMimeType(ContentService.MimeType.TEXT);
}

/**
 * =========================
 * PC → タブレット
 * A1が書き換えられたら C1 を更新
 * =========================
 */
function onEdit(e) {
  const range = e.range;
  const sheet = range.getSheet();

  // A1 以外は無視
  if (range.getA1Notation() !== "A1") return;

  // 日本時間で日時を書き込む
  const now = Utilities.formatDate(
    new Date(),
    "Asia/Tokyo",
    "yyyy/MM/dd HH:mm:ss"
  );

  sheet.getRange("C1").setValue(now);
}
